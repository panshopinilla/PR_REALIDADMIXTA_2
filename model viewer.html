<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>C√°mara AR - Tambo de Camar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <style>
        /* Reset y fondo oscuro */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; font-family: 'Helvetica', sans-serif; overflow: hidden; }
        
        /* El visor ocupa todo, pero lo oscurecemos inicialmente */
        model-viewer { 
            width: 100%; height: 100%;
            /* Truco: Hacemos que el fondo del modelo 2D sea transparente para que se vea nuestro overlay */
            --poster-color: transparent;
            background-color: transparent;
        }

        /* CAPA DE INSTRUCCIONES INICIALES */
        #overlay-instrucciones {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); /* Fondo semitransparente */
            color: white; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            padding: 30px; box-sizing: border-box; z-index: 10;
        }

        #overlay-instrucciones h1 { margin: 0 0 15px 0; font-size: 24px; color: #EB6242; }
        #overlay-instrucciones p { font-size: 16px; line-height: 1.5; margin-bottom: 30px; max-width: 80%; color: #ccc; }
        .paso-icono { font-size: 40px; margin-bottom: 20px; }

        /* ESTILO DEL BOT√ìN DE ACTIVACI√ìN (El slot="ar-button") */
        /* Lo transformamos en el bot√≥n principal grande */
        #boton-activar-ar {
            background-color: #EB6242; color: white;
            border: none; border-radius: 50px;
            padding: 18px 40px; font-size: 18px; font-weight: bold;
            box-shadow: 0 4px 20px rgba(235, 98, 66, 0.5);
            cursor: pointer; transition: transform 0.2s;
            /* Posicionamiento absoluto para que quede sobre el overlay */
            position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%);
            z-index: 20; /* Debe estar sobre el overlay */
            display: flex; align-items: center; gap: 10px;
            white-space: nowrap;
        }
        #boton-activar-ar:active { transform: translateX(-50%) scale(0.95); }

        /* Bot√≥n de cerrar */
        .btn-close { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.2); color: white; border: none; padding: 10px 15px; border-radius: 30px; text-decoration: none; font-size: 14px; z-index: 30; backdrop-filter: blur(5px); }

        /* CUANDO AR ARRANCA: Ocultar instrucciones */
        /* model-viewer a√±ade autom√°ticamente atributos cuando entra en AR */
        model-viewer[ar-status="session-started"] #overlay-instrucciones,
        model-viewer[ar-status="session-started"] #boton-activar-ar {
            display: none;
        }
    </style>
</head>
<body>

    <a href="#" onclick="window.close()" class="btn-close">‚úï Cerrar</a>

    <div id="overlay-instrucciones">
        <div class="paso-icono">üì±‚¨áÔ∏è</div>
        <h1>Modo Maqueta AR</h1>
        <p>1. Activa la c√°mara.<br>2. Apunta al suelo y mueve el celular suavemente.<br>3. Toca la pantalla para colocar la maqueta.</p>
        </div>

    <model-viewer 
        src="./assets/models/tambo_web.glb" 
        alt="Maqueta Tambo de Camar"
        ar 
        ar-modes="webxr scene-viewer quick-look"
        camera-controls
        interaction-prompt="none"
        ar-placement="floor"
        ar-scale="auto"
        shadow-intensity="1">

        <button slot="ar-button" id="boton-activar-ar">
            üì∏ ACTIVAR C√ÅMARA
        </button>

    </model-viewer>

    <script>
        const viewer = document.querySelector('model-viewer');
        // Detectar si el dispositivo NO soporta AR para avisar
        viewer.addEventListener('load', () => {
            if (!viewer.canActivateAR) {
               document.getElementById('overlay-instrucciones').innerHTML = "<h1>‚ö†Ô∏è Lo sentimos</h1><p>Tu dispositivo o navegador no soporta Realidad Aumentada web.</p>";
               document.getElementById('boton-activar-ar').style.display = 'none';
            }
        });
    </script>

</body>
</html>